# CPSC 449 Project 3 
 [Project 3](https://docs.google.com/document/d/1OWltxCFRsd2s4khOdfwKLZ3vqF6dsJ087nyMn0klcQs/edit) involves extending the mock Wordle backend application from [Project 1](https://docs.google.com/document/d/14YzD8w5SpJk0DqizgrgyOsXvQ2-rrd-39RUSe2GNvz4/edit) and splitting the monolithic code into seperate functional services, implementing nginx to authenticate endpoints and setting up API gateways with reverse proxy and load balancing from [Project 2](https://docs.google.com/document/d/1BXrmgSclvifgYWItGxxhZ72BrmiD5evXoRbA_uRP_jM/edit) to include the following objectives:
- Configuring three replicas for the database associated with Games service. (Write requests go to the pirmary replica, and read requests can be made from either primary, secondary or tertiary)
- Creation of new Leaderboard service which can post results of a game, and obtain the Top 10 players based on their average scores.
- Use LiteFS and the Redis NoSQL database and client libraries to store data for leaderboard service.

This project also builds upon concepts introduced in [Exercise 2](https://docs.google.com/document/d/1-tFBfCP2rhk5YFtXYpGD894Ghy4UY-J3o9Zs7abbS8c/edit), [Exercise 3](https://docs.google.com/document/d/14i8cpm7z1oFh5y5gmAkQ39AH3Pu8oWRr6B6TOziGYhY/edit) with regards to setting up Nginx server, building indices, and using redis NoSQL database and associated libraries.

### Authors
Section 02
Group 23
Members:
- Harshith Harijeevan
- Heet Savla
- Jayraj Arora
- Yash Gandhi

## Setting Up
### Development Environment 
Tuffix 2020 (Linux)

### Application Prerequisites
- Python
- Nginx
- Quart
- Sqlite3
- Foreman
- Databases
- Quart-Schema
- Curl
- HTTPie
- redis
- LiteFS

### VHost Setup
1. Make sure that nginx is running in the background
```
$ sudo service nginx status
```
2. Verify that `tuffix-vm` is in `/etc/hosts`
```
$ cat /etc/hosts
```
__Note:__ This project uses the hostname `tuffix-vm`. 
3. Copy the VHost file in `/share` to `/etc/nginx/sites-enabled` then restart nginx 
```
$ sudo cp share/wordle /etc/nginx/sites-enabled/wordle
$ sudo service nginx restart
```

### Initializing and Starting the Application
1. Go to the project's directory
2. Start the app with Foreman
```
foreman start
```
3. Run the command below to initialize databases and populate them with values.
```
./bin/init.sh
```

## REST API Features
- Register a user (includes password hashing)
- Authenticate a user (includes hashing verification)
- Start a new game
- Guess a five-letter word
- Retrieve the state of a game in progress
- List the games in progress for a user
- Check the statistics for a particular user
- Fetch the results of a game using the number of guesses taken.
- Retrieve the top 10 users based on their average scores.

## Running the Application

### Registering a User
After starting up the app, create an initial user using the following command with HTTPie where `<username>` and `<password>` are custom values (will need them later when logging in):
```
http POST http://tuffix-vm/register username=<username> password=<password>
```
The whole application can only be accessed after authentication, so use the username and password that was created in this step.


### Using Quart-Schema Documentation
The API documentation generated by Quart-Schema can be accessed with [this link](http://tuffix-vm/docs) or typing the URL `http://tuffix-vm/docs`. Note that this is only for the Game endpoint.


### Using HTTPie
In order to run via httpie, use the following the commands:
- Creating a user
```
http POST http://tuffix-vm/register username=<username> password=<password>
```
- Authenticating a user
```
http GET http://tuffix-vm/ --auth <username>:<password>
```
- Creating a game 
```
http POST http://tuffix-vm/games --auth <username>:<password>
```
- Checking the state of a game 
```
http GET http://tuffix-vm/games/<game_id> --auth <username>:<password>
```
- Playing a certain game/making a guess
```
http POST http://tuffix-vm/games/<game_id> guess=<5-letter-word> --auth <username>:<password>
```
- Retrieving a list of in-progress games
```
http GET http://tuffix-vm/games/ --auth <username>:<password>
``` 
- Check the statistics of the user 
```
http GET http://tuffix-vm/games/statistics --auth <username>:<password>
```
- Fetch the results of a game using the number of guesses taken.
```
http GET http://127.0.0.1:5400/results guess_number=<Number from 1 to 6> status=<Win or Loss> username=<username>
```
- Retrieve the top 10 users based on their average scores.
```
http GET http://127.0.0.1:5400/leaderboard
```
